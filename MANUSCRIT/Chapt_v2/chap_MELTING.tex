%%%%%%%%%%%%%%%%%%don't forget if needed %%%%%%%%%%%%%%%%%%%%%
%\section[toc version]{title version%
%              \sectionmark{head version}}
%\sectionmark{head version}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\titcourt{Numerical simulation of Phase Change Material in two-dimensional configuration}
\def\titlong{Numerical simulation of Phase Change Material in two-dimensional configuration}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter[\titlong]{\titlong%
              \chaptermark{\titcourt}}
\chaptermark{\titcourt}
\label{chap-MELTING}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{figure}
	\begin{center}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/EXPE_GONG_melting}
	\end{center}
	\caption{Experimental observation of the melting of n-octadecane within a transparent brick of plexiglas heated vertically from the left by \cite{gong2015numerical}, obtained by particle image velocimetry (PIV) method.}
	\label{fig:expe-PCM_Gong}
\end{figure}

Having proven the efficiency and the accuracy of both sequential and parallel algorithms to deal with the Navier-Stokes-Boussinesq equations, we now pay a closer attention to the phase-change evolving natural convection problems.
Fig. \ref{fig:expe-PCM_Gong} showing the experimental investigation of the melting of n-octadecane inside a transparent brick \cite{gong2015numerical} depicts very well the complexity of the problem.
The investigated PCM is heated from the right and melts from the right to the left.
Panel (a) displays the evolution of the liquid fraction and panel (b) shows the vector field in the fluid obtained by particle image velocimetry (PIV) method.
Capturing accurately the non-linear evolution of the solid-liquid interface, due to the strong convection in the melting PCM, is clearly a challenging numerical task.
Furthermore, the existence of boundary layers near the left vertical wall and the interface is also illustrated in Fig. (\ref{fig:expe-PCM_Gong}b) suggesting that the mesh resolution should allow to capture these structures.
This chapter aims thus to validate accurately our developed method with respect to physical feature of the problem.
Discussion about the numerical parameters is given first followed by a sequence of comparison according to different physical and geometrical configurations.

The Newton algorithm in eq. (\ref{eq-newton-C1}) is now solved in the whole domain containing liquid and solid phases.
When compared to the previous validation, two new non-linearities are now treated: the Carman-Kozeny penalty term in the momentum equation and the enthalpy source term in the energy equation.
The Carman-Kozeny penalty term is used to ensure zero velocity in the solid region and 
the enthalpy non-linear source term is included to model the phase-change in the energy equation.
Following the same idea as the natural convection validation in Chap. (\ref{chap-NATCONV}), non-linearity in the body force is gradually added.
We consider first the linear form of $f_B(\theta)$ by investigating the melting of various PCM within several containers.
Then, the challenging case of water freezing described by a non-linear variation of the density (see eq. (\ref{eq-dens-nonlin}) in Chap. (\ref{chap-NATCONV})) is computed.

Details about the parameter settings are first given in Sec. (\ref{sec-param-set}):
the characteristics of the mushy-zone, the mesh adaptivity and the initial condition are discussed in details.
Second, the melting of octadecane and gallium are presented in Sec. (\ref{sec: melting-2D}) and Sec. (\ref{sec-melt-gallium}).
Gallium and n-octadecane are the most investigated material in the frame of PCM analysis, be it experimentally \citep{gau1983flow,campbell1994visualization,Okada1984,gong2015numerical}, numerically \citep{rady1996natural,bertrand1999melting,hannoun2003resolving,Wang2010,dan-2014-JCP,rakotondrandisa2019numerical} or theoretically \citep{Okada1984,jany1988scaling,bejan1989analysis,kowalewski2004phase,chabot2017solid}. 
Besides their physical properties are equal in both liquid and solid phases (difference less than $3 \%$), gallium and n-octadecane melt near room temperature, making them the preferred materials for experimentally investigating melting and solidification of low and high Prandtl-number PCMs.
These problems in a rectangular cavity have been also extensively used in the literature for the assessment of phase-change numerical methods and will be used in the present work to assess the accuracy of our numerical method. 
The physical properties of octadecane and gallium used in our simulations are reported in Tab. (\ref{tab-param-PCM}).
\begin{table}[ht!]
   \begin{center}
      \begin{tabular}{*{8}{cl}}
         
        &$\rho$ &$ \mu$ & $h_{SL}$ & $c_p $ & $k$ & $T_f$ & $\beta$ \\
        &kg/m$^3$ & kg/(m s) & kJ/kg & J/(kg K) & W/(m K) & K & 1/K \\
         \hline
        Octadecane & 774 & 3.9 $\cdot 10^{-3}$  & 244 & $2180$ & $0.152$ & $301$ & 8.5 $\cdot 10^{-4}$ \\
        Gallium & 6093 & 1.81 $\cdot 10^{-3}$  & 80.16 & $381.5$ & $32$ & $301$ & 1.2 $\cdot 10^{-4}$ \\
      \end{tabular}
   \end{center}
   \caption{Physical parameters of octadecane and gallium PCM, used in our simulations.}
   \label{tab-param-PCM}
\end{table}
%Octadecane is representative of high-Prandtl material while gallium is representative of low-Prandtl PCM.
%Experimental and numerical benchmarks from the literature are used to validate our numerical method.
%Three benchmarks are considered for the octadecane: \cite{Okada1984} (experimental), \cite{gong2015numerical} (experimental) and \cite{bertrand1999melting} (numerical).
%The melting of the gallium is compared with the numerical investigation of \cite{hannoun2003resolving}.
Then, Secs. (\ref{subsec-luo}) and (\ref{sec-solid-crust}) shows the power of our code to deal with different geometrical configurations.
The melting of cylindrical PCM with inner heated tubes is discussed in Sec. (\ref{subsec-luo}) and the solid crust formation in a highly distorted mesh is carried out in Sec. (\ref{sec-solid-crust}).
Finally, the water freezing is shown in Sec. (\ref{sec-water-freeze}).
Although the non-linear definition of the body force, the challenging feature of the water freezing case is the tracking of both solidification front and anomalous thermal variation of water density proving the effectiveness of the mesh adaptivity.
Our result is qualitatively compared with the experimental work of \cite{Kowalewski-1999}.

%For the simulation of the melting process, we use the following choice for the scaling introduced in Sec. \ref{sec-eq-scaling}, eqs. (\ref{eq-adim}) and  (\ref{eq-RePr}):
%\begin{equation}\label{ref-adimPCM}
%V_{ref}=\frac{\nu_l}{H}  \, \Rightarrow  \, t = t_{\varphi}\frac{\nu_l}{H^2} \, \Rightarrow  \, \Rey  = 1. \\
%\end{equation}
The scaling (\ref{eq-def-scal-1}) is used for the numerical simulation of the melting.
The dimensionless time $\tau$ is introduced in order to assess our results with respect to the numerical data of \cite{bertrand1999melting} and the analytical correlation of \cite{jany1988scaling}:
\begin{equation}
\label{eq-adim-tau}
\tau = \Ste\cdot Fo = \Ste\cdot \frac{\alpha t_{\varphi}}{H^2}  = \Ste\cdot \frac{t}{Pr},
\end{equation}
where $Fo$ is the Fourier number. 

We recall that the reference temperature is the fusion temperature and thus $\theta_f = 0$. The mushy zone is defined for $ -\varepsilon_1 \leq \theta \leq \varepsilon_2 $, with $\varepsilon_1 = \varepsilon_2 = 0.01$.  
We also assume that physical properties of the material are identical in both liquid and solid phases, and, consequently, we obtain from (\ref{eq-adimKC}) that   $C(\theta)=1$ and $K(\theta)=1$.
This choice of the scaling was made to have the same set of parameters as in previous numerical simulations of this case \citep{Okada1984, Wang2010, Ma2006, dan-2014-JCP}. 

\section{Parameter settings} \label{sec-param-set}
The numerical parameters in the model are detailed in sec. \ref{sec-desc-prog}.
We present in this section the influence of some parameters on the numerical resolution of the Newton algorithm, namely the initialization, the Caraman-Kozeny constant in the penalty term \ref{eq-CK}, the mesh adaptation and the size of the mushy zone.


\subsection{Carman-Kozeny constant}
The Carman-Kozeny penalty term is used to annihilate the velocity in the solide region when a single domain method is applied.
The Carman-Kozeny constant \ref{eq-CK} is a constant accounting for the mushy-region morphology.
The effect of this constant on the melting and the solidification have attracted some attention.
Even though it is generally assumed that a large value for $\CKC$ must be set, the exact value of this constant could influence the accuracy of the results \citep{kheirabadi2015effect, kumar2017influence}. 
The influence of $\CKC$ in the location of the front was shown by \citep{kheirabadi2015effect}.
They concluded that, high $\CKC$ values corresponded to slower melting rates and the smallest $\CKC$ values resulted in unphysical predictions of the melt front development.
They also noticed that $\CKC$ and the melting temperature range $\Delta T_{\varepsilon} = T_{\varepsilon2}-T_{\varepsilon1}$ are dependent of one another: different values of $\Delta T_{\varepsilon}$ requires different values of $\CKC$ to achieve the same melt front location.
\cite{Kumar2017} studied the effect of the mushy zone constant and its influence on the melt fraction, vortex strength and the amount of heat storage. They concluded that increasing $\CKC$ leads to a decrease of the convection strength and consequently leads to a decrease of the heat transfer rate. 
These studies show the necessity of choosing an appropriate value of this parameter, but because of the semi-solid state and porous nature of the mushy zone, the choice of the value of this constant is a still open problem.

We simulate the melting of a PCM with different value of $\CKC$ ranging from $10^6$ to $10^10$ and compare the location of the melting front with experimental data.
Fig. \ref{fig:pcm-CK} displays the location of the melting interface for three values of $\CKC$: $10^6$, $10^8$ and $10^{10}$.
Very good agreement with the experimental result of \cite{Okada1984} is obtained for $\CKC$ varying in the range $[10^6, 10^8]$. 
Nevertheless, imposing  a too large value $\CKC=10^{10}$ results  in artificially slowing the propagation of the melting front. We set for all subsequent simulations $\CKC= 10^6$.

\begin{figure}
	\begin{center}
		\includegraphics[width=.5\textwidth]{\figpath/Fig_cap_melting/PCM_ck_compare}
	\end{center}
	\caption{Location of the interface during the melting of the PCM using different value of $\CKC$ ranging from $10^6$ to $10^20$. Comparison with experimental data of \cite{Okada1984}}
	\label{fig:pcm-CK}
\end{figure}

\subsection{Mesh adaptativity}


The use of mesh adaptation proved mandatory in the simulation of the melting of a PCM to obtain accurate results within reasonable computational time.
For the melting case, we used five metrics intersection to adapt the mesh, based on $S^{n+1}, S^{n}, T^{n+1}, T^{n}, \vec{u}^{n+1}$. To reduce the impact of the interpolation on the global accuracy for time-depending problems, we consider the metrics computed from actual (at $t_{n+1}$) and  previous (at $t_{n}$) values, for the same variable used for adaptivity (see also \cite{Belhamadia2004_S}).
The anisotropy of the mesh is a parameter of the algorithm and it was set to values close to 1. This is an inevitable limitation since we also impose the minimum edge-length of triangles to avoid generating too large number of nodes.

\begin{figure}
	\begin{center}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/Mesh_MELT}
	\end{center}
	\caption{Adapted mesh during PCM melting. (a) $12,000$ triangles: mesh is refined around the melting front and the boundary layers. (b) zoom showing the decrease of the mesh size around the temperature isoline $\theta = 0$.}
	\label{fig:pcm-mesh}
\end{figure}

The method is able to accurately capture the liquid-solid interface during the melting process and the two solidification fronts appearing during the solidification of the PCM. 
Mesh adaptivity is performed at each time step and offers a refined discretization of the regularization region where sharp gradients have to be accurately captured.  
Fig. \ref{fig:pcm-mesh}a illustrates the adapted mesh during the melting.
The mesh is refined around the melting front (Fig \ref{fig:pcm-mesh}b), localized by the temperature $\theta = 0$, while coarser mesh is applied in the solid region.
The number of triangles for the melting case is $N_t=12,000$. Non-adapted grids offering the same spatial resolution everywhere inside the computational domain would have resulted for the two cases in $N_t=9.94 \cdot 10^{10}$ triangles, respectively. Consequently, mesh adaptivity greatly helps in reducing the computational time. 

The minimum and the maximum edge-length of triangles are imposed to avoid too large meshes.
At the same time, the minimum size of triangles should allow to capture the boundary layers and the artificial mushy zone where discontinuous variables are smoothly regularized.
As far as the boundary layers are concerned, Fig. \ref{fig:min-size-bnd} draws the thermal ($\delta_T$) and the viscous ($\delta_\nu$) boundary layers, function of Prandtl number.
The scale for the thermal boundary layer in natural convection flow along a vertical wall is indeed given by \citep{bejan2013convection}:
\begin{equation} \label{eq-bnd-layer-T}
   \delta_T \sim \left\{
   \begin{array}{ll}
   H Ra^{-1/4} &	 \mbox{if }  Pr \gg 1,\\
   H Pr^{-1/4} Ra^{-1/4} &   \mbox{if } Pr \ll 1,
   \end{array}
   \right.
\end{equation}
and the scale for the thickness of the viscous boundary layer near the wall is:
\begin{equation} \label{eq-bnd-layer-nu}
   \delta_\nu \sim Pr^{1/2} \delta_T.
\end{equation}
Thus, for high-Prandtl simulations the thickness of the thermal boundary layer is thinner than the velocity and the viscous boundary layers. 
For Rayleigh numbers in the range of $10^6$ to $10^8$ and a Prandtl number of order of $50$, we have a dimensionless thickness of the thermal boundary layer of $\delta_\theta \sim 0.01$.
Conversely, for low-Prandtl simulations the viscous boundary layer is thinner than the thermal boundary layer.
For the same range of Rayleigh numbers ($10^6$ to $10^8$) and Prandtl number of order of $0.1$, we have a dimensionless thickness of the viscous boundary layer of $\delta_\nu \sim 0.015$.
Therefore the minimum edge-length must be lower than $0.01$.
Moreover, a minimum of 8 triangles should be included in the mushy zone to ensure an accurate location of the melting interface and a correct resolution of gradients.
Consequently, for all subsequent simulations the minimum edge-length is set to $h_{min} = 10^{-3}$ and the maximum edge-lenght to $h_{max} = 0.1$.

\begin{figure}
	\begin{center}
		\includegraphics[width=.8\textwidth]{\figpath/Fig_cap_melting/thermal_bnd}
	\end{center}
	\caption{Thermal and viscous boundary layer thickness function of the Prandtl number \citep{bejan2013convection}.}
	\label{fig:min-size-bnd}
\end{figure}

\subsection{Initialization}
The initialization is critical task in the Newton algorithm.
The PCM is initially solid and the temperature should be set to a cold temperature $\theta_c$ under the temperature of fusion $\theta_f$.
However, increasing abruptly the boundary temperature to a hot temperature $\theta_h$, over the temperature of fusion, in order to initiate the melting process is numerically complicate because of the strong temperature gradient between the wall and the PCM.

A first solution is to set a very thin fluid layer of  $\delta x = 0.01$ with a constant temperature $\theta = \theta_c$.
The drawback of this approach is that it is not physical and the evaluation of some physical properties depending on the temperature gradient at the heated wall, like the Nusselt number or the accumulated heat input, can be distorted.

A second approach consist of setting an establishment regime.
The temperature is increased smoothly over a small time steps combined with Rayleigh continuation steps.
This approach has physical significance and is more robust when higher Rayleigh number simulations are tackled.

\newpage

\section{Melting of n-octadecane PCM in a square cavity} \label{sec: melting-2D} %: Comparison with experimental data of \cite{Okada1984}  and \cite{gong2015numerical}, and numerical data of \cite{bertrand1999melting}.}
The melting of n-octadecane PCM is the starting point of our validation exercices.
Three cases are investigated: \\
\underline{\it Benchmark 1}: the first consists of an experimental study of the melting of the PCM in a differentially heated square cavity of height $H=1.5$ cm by \cite{Okada1984}. 
The non-dimensional parameters resulting from the physical properties of n-octadecane presented in Tab. (\ref{tab-param-PCM}) are: $\Ray = 3.27 \cdot 10^5$, $\Pr = 56.2$ and $\Ste = 0.045$ .\\
\underline{\it Benchmark 2}: the second reproduces the melting of the PCM included in a transparent building brick of height $H = 15.2$ cm, investigated experimentally and numerically by \cite{gong2015numerical}. 
The non-dimensional parameters corresponding to their experimental study are: $\Ray = 2.48 \cdot 10^8$, $\Pr = 50$ and $\Ste = 0.072$.\\
\underline{\it Benchmark 3}: the last compares our results with various numerical methods, presented by \cite{bertrand1999melting}, simulating the melting of octadecane, considering high value of the Rayleigh number.
The computed parameters are: $\Ray = 10^8$, $\Pr = 50$ and $\Ste = 0.1$.\\
\begin{figure}
	\begin{center}
		\includegraphics[width=0.85\textwidth]{\figpath/Fig_cap_melting/fig02_2}
	\end{center}
	\caption{Location of the interface during the melting of the PCM. 
	(a) Comparison with experimental data of \cite{Okada1984} and numerical results of \cite{dan-2014-JCP} and \cite{Wang2010} for two time instants ($\tau=0.032$ and $0.063$). Benchmark 1: $\Ray = 3.27 \cdot 10^5$, $\Pr = 56.2$ and $\Ste = 0.045$
	(b) Comparison with both experiment and simulation of \cite{gong2015numerical} for five time instants  ($\tau = 0.0002$, $0.00050$, $0.00067$, $0.00125$, $0.00252$). Benchmark 2: $\Ray = 2.48 \cdot 10^8$, $\Pr = 50$ and $\Ste = 0.072$.
	}
	\label{fig:pcm-valid}
\end{figure}

For each cases, at $t=0$ the PCM is fully solid at temperature under the temperature of fusion $\theta_h$.
Then the left wall is heated at dimensionless temperature $\theta_h = 1$ initiating the melting and the right wall is held at constant dimensionless temperature $\theta_c = -0.01$.
The top and the bottom walls are adiabatic and a no-slip velocity boundary condition is used.

We first examine the location of the interface obtained in our simulations.
The comparison with the experimental results of \cite{Okada1984} and \cite{gong2015numerical} is presented in Figure \ref{fig:pcm-valid}.
The experimental study of \cite{Okada1984} in Figure \ref{fig:pcm-valid}(a) consists of a differentially heated square cavity of dimensions $1.5$ cm $\times \, 1.5$ cm. %, filled with an octadecane paraffin. 
For two particular time instants ($\tau=0.032$ and $\tau=0.063$), we could compare our results to available experimental \citep{Okada1984} and numerical \citep{Okada1984,Wang2010,dan-2014-JCP} data. 
In the experimental set up of \cite{Okada1984}, the author has reported that the top of the PCM was not perfectly insulated and consequently the growth of the experimental upper melting front was delayed.
In Figure \ref{fig:pcm-valid}(a), for the two time instants $\tau=0.032$ and $\tau=0.063$, the current work agrees well with the experimental results of \citep{Okada1984} at the bottom part of the melting front.
However, our results overestimate the location of the front in the top part of the cavity, which could be related to the experimental heat loss mentioned by the author.
Moreover, our results are qualitatively in a better agreement with experimental data than previously published numerical results. 
This is a direct consequence of the precise tracking of the melting front achieved by the mesh adaptivity performed at each time step.
\cite{Wang2010} have used a FV code with a fixed mesh of resolution $[60 \times 60]$, and \cite{dan-2014-JCP} have used a first order FE method with adaptative grid.

Figure \ref{fig:pcm-valid}(b) illustrates the interface location in the experiment and simulations of   \cite{gong2015numerical}, who studied the melting of an octadecane PCM inside a transparent building brick of dimensions 
$15.2$cm$\times 3$cm.
Their numerical simulation has been performed using a hybrid thermal Lattice Boltzmann method combined with an enthalpy method. 
The difficulty here compared to the first validation case is the presence of a stronger natural convection flow in the fluid due to the high value of the Rayleigh number.
The location of the interface is compared for five particular time instants: $\tau = 0.0002$, $0.00050$, $0.00067$, $0.00125$ and $0.00252$.
We notice a very good agreement with the numerical and the experimental data of \cite{gong2015numerical}.


A last validation case is also investigated to test the robustness of the method.
\cite{bertrand1999melting} compiled results provided by five different authors (Lacroix, Le Qu{\'e}r{\'e}, Gobin-Vieira, Delannoy and Binnet-Lacroix). Results provided by these authors will be hereafter referred to as (say) 'Lacroix, from \cite{bertrand1999melting}'.
They have attempted a first comparison by taking several numerical methods to compute the basic configuration presented in this section. 
Two investigators among the five failed to predict the process and showed unrealistic behaviors (see Figures \ref{fig Bertran} and \ref{fig-Nu-Lf-Bertran}):
Lacroix and Delannoy seem to be insufficiently converged (Figure \ref{fig Bertran}), and Binet-Lacroix overestimates the average Nusselt number by more than $30 \%$ (Figure \ref{fig-Nu-Lf-Bertran}).
Hence, this collection of results allows us to compare our numerical method and check whether or not realistic results are obtained for complex physical configurations.\\
We further inspect the melting front, the temporal evolution of the liquid fraction $L_f$ and the Nusselt number $N\!u$ at the left wall ($x=0$), for each of the five methods presented by \cite{bertrand1999melting}.
For the liquid fraction, the initial solid state corresponds to $L_f = 0$, while  $L_f = 1$ indicates the  complete melting of the PCM. 
%The average Nusselt number $N\!u$ at $x=0$ left boundary is defined as follows:
%\begin{equation}\label{eq-Nu}
%N\!u = \int_{0}^1 \left(\frac{\partial \theta}{\partial x}\right)_{x=0}\, dy.
%\end{equation}
%\\
\begin{figure}
	\begin{center}
		\begin{minipage}[t]{0.75\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/fig03}
		\end{minipage}
	\end{center}
	\caption{Melting of a PCM (Benchmark 3). Location of the solid-liquid interface at dimensionless time (panels a to d) $\tau = 0.0005$,  $\tau = 0.002$, $\tau = 0.006$ and $\tau = 0.01$, compared with five simulations presented by \cite{bertrand1999melting}. 
	$\Ray = 2 \cdot 10^8$, $\Pr = 50$ and $\Ste = 0.1$.} \label{fig Bertran}
\end{figure}
\begin{figure}
	\begin{center}
		\begin{minipage}[t]{0.75\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/fig04}
		\end{minipage}
	\end{center}
	\caption{Time evolution of the Nusselt number (a) and the liquid fraction (b) compared with five simulations presented by \cite{bertrand1999melting}.
	$\Ray = 2 \cdot 10^8$, $\Pr = 50$ and $\Ste = 0.1$.} \label{fig-Nu-Lf-Bertran}
\end{figure}
The phase-change interface for four time steps, $\tau = 5 \cdot 10^{-4}$, $\tau = 2 \cdot 10^{-3}$, $\tau = 6 \cdot 10^{-3}$ and $\tau = 1 \cdot 10^{-2}$ is represented in Figure \ref{fig Bertran}.
Our results are for each case in fairly good agreement with those of Gobin and those of  Le Qu{\'e}r{\'e}.
Gobin uses a front-tracking method using a coordinate transformation with a finite volume method with a $62 \times 42$ grids.
Le Quéré solves a single domain model using a second order scheme with a finite volume method with a $192 \times 192$ grids  (\cite{gobin2000melting}).
The time evolution of the Nusselt number and the liquid fraction are presented in Figure \ref{fig-Nu-Lf-Bertran}.
A very good agreement is obtained with Gobin and Le Qu{\'e}r{\'e}.
A relative difference, less than $2\%$ is noticed for the Nusselt number, and a dispersion, smaller than $4 \%$, for the melted fraction.\\
The high value of the Rayleigh number $\Ray = 10^8$ results in a very demanding numerical test.
The high velocity, inducing a very narrow thermal boundary layer can lead to unrealistic results and some numerical methods have failed.
The interest of the mesh adaptation is clearly evidenced since we  initially use only $40 \times 40$ grid points.


\section{Melting of Gallium in a rectangular cavity} \label{sec-melt-gallium}

The observation on the melting of the gallium in a rectangular cavity was a controversy since the question if  the flow in the fluid is monocellular of multicellular was raised by \cite{dantzig1989modelling}.
The experimental result exhibits indeed a monocellular structure, while many researchers claim this observation to be incorrect.
Prior to \cite{dantzig1989modelling} note, both experimental and numerical result support a single cell solution in the fluid phase.
Later, simulations provides solutions with multicellular flow. 
\cite{hannoun2003resolving} concluded that monocellular observation is caused by a problem of convergence of the numerical solution. It can be due to the grid size or inconsistencies in the mathematical model.

Therefore, this test case simulating the melting of the Gallium is a relevant exercice to test the consistency of our method.
To capture the very small cell during the first step of the melting, \cite{hannoun2003resolving} uses a $800 \times 1,120$ fixed grids in a rectangular domain of dimensions $6.35$ cm $\times \, 8.89$ cm. 
However, a maximum of $6 000$ triangles are necessary with our adaptive method to reproduce the numerical result of \cite{hannoun2003resolving}, that is a ratio of $10^2$.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/evol_Gallium_FIELD}
		\end{minipage}
	\end{center}
	\caption{Melting of gallium: temperature field, streamlines, and melting front. 
	Physical time instants (panels a to g): $20 s$, $32s$, $36s$, $42s$, $85s$, $155s$, and $280s$.} \label{fig-Gallium}
\end{figure}

We consider a rectangular cavity of  $0.0635m$ height and $0.0889m$ width.
The dimensionless parameters corresponding to the gallium physical description in Tab. (\ref{tab-param-PCM}) are: $\Ray = 7 \cdot 10^5$, $\Prd = 0.0216$ and $\Ste = 0.046$.
%Gallium differs from n-octadecane since $\Prd < 1$.

The time evolution of the flow is presented in the Figure \ref{fig-Gallium} with the plot of the streamlines for several physical times: $t_{\varphi} = 20s$, $32s$, $36s$, $42s$, $85s$, $155s$ and $280s$.
These times was voluntarily chosen for they correspond to roll merging.
\cite{hannoun2003resolving}, \cite{cerimele2002numerical} and \cite{giangi2000melting} compare the number of rolls in the fluid flow as a validation criterion.
Five primary cells are captured at $t=32s$ and decreases later through a process of roll merging as it is noticed by \cite{hannoun2003resolving}.
Our numerical results are in good agreement with the observations of \cite{hannoun2003resolving}, \cite{cerimele2002numerical} and \cite{giangi2000melting}.

%\section{Melting of PCM included in different geometries: cylindrical evolving inclusions, distorted mesh and rectangular}
\section{Melting of cylindrical PCM with inner heated tubes} \label{subsec-luo}

We have simulated previously phase-change problems within rectangular cavities.
A more complex system is studied in this section, by simulating the melting of pure PCM on multitube thermal energy storage systems.
Similar configurations were studied by \cite{luo2015lattice}. Hence we could compare our numerical results to those of \cite{luo2015lattice}.
The interest is twofold: the geometry is challenging since is it complex and \cite{luo2015lattice} uses Lattice Boltzmann method, a microscopic model, which is different from previous validation cases.

Cylindrical PCM of dimensionless radius $R=1$ with tube inclusions are studied.
Shell and tube PCM are indeed most intensely used in latent heat energy storage systems.
\cite{agyenim2010review} pointed out, in a critical review of materials used for heat storage, that more than $70\%$ of the PCM container are using the shell and the tube system.

We simulate three cases taking into account one heated tube, four heated tubes, and nine heated tubes with the same contact area.
For the one heated tube case, the radius $R_i$ of the inner tube is one-quarter of the outer tube ($R_i = R/4$), for four heated tubes $R_i = R/8$ and for nine heated tubes $R_i = R/12$.
A Dirichlet boundary condition is applied to inner tubes $\theta = \theta_h$,
and a Neumann boundary condition $\frac{\partial \theta}{\partial n} = 0 $ is used at the outers.
An homogenous Dirichlet boundary condition ($\vec u = 0$) is applied everywhere for the velocity.
We have compared for the interested $\Ray$ number the simulation of the entire domain and the half of the domain and the same results were observed.
When the entire domain is investigated however, the axisymmetry of the adapted mesh is not directly handle by the mesh adaptivity algorithm and could influence the numerical solution.
To overcome this issue, the metrics for the mesh adaptivity is computed only on the half of the domain.
In the present work, only the half of the domain is simulated since the problem is symmetric because of the low $\Ray$ number investigated.
The mesh is refined initially around inner tubes, and is dynamically adapted at each time step around the melting front and the thermal boundary layer area.
The physical parameters of the simulation are:  $\Ray = 5 \cdot 10^4$, $\Pr =0.2$ and $\Ste = 0.02$.
%The same metrics presented in \ref{sec-case1} are used for the mesh adaptation process.

The temperature distributions for each of the three cases are shown in panels (a) to (c) of Fig. (\ref{fig-Luo-Field}).
The solid-liquid interface is denoted by black line.
We can observe first the main differences in the shape of the melting front.
The more the number of inner tubes is the more the interface is distorted.
%The melting front (black line), the temporal evolution of the temperature field, and the time evolution of the liquid fraction, showing the effect of the configuration, are shown in Figures \ref{fig-Luo-Field} and \ref{fig-Lf-Luo}.
%The configuration of the obstacles in the liquid phase, influences directly the fluid motion and the shape of melting front.
This is directly linked to the effect of the fluid motion in the presence of obstacles as it was also noticed in Sec. (\ref{sec: natconv-water}).
The natural convection in the melted PCM is strengthened with the increasing number of inner heated tubes and impacts strongly the shape of the interface.
%The more the number of inner tubes, the stronger the natural convection in the melted PCM.
%Consequently the shape of the interface is impacted.


The time evolution of the liquid fraction is plotted in Fig. (\ref{fig-Lf-Luo}a).
It is manifest that the heat transfer is enhanced by the number of inner heated tubes since a faster melting time is observed: a ratio of $5.4$ is noticed from the melting time with nine and one tubes.
The current simulation is compared with the numerical data of \cite{luo2015lattice} and a good agreement is obtained.
We also assess the effect of the inner tubes arrangements. 
Fixing the number of heated obstacles, three arrangements are carried out: centrosymmetric, inline and staggered arrangements.
The time evolution of the liquid fraction for nine tubes is reported in Fig. (\ref{fig-Lf-Luo}b).
Centrosymmetric arrangement appears to provide a better heat transfer compared to the others.
The inline and the staggered arrangements exhibits similar trends, with a slightly faster melting rate within the inline arrangement.
The difference is explained by \cite{luo2015lattice} by the contribution of conductive heat transfer induced by the arrangements.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/MELT_Luo_Field}
		\end{minipage}
	\end{center}
	\caption{Temperature field for the melting of cylindrical PCM, in the half of the domain, with one (a), four (b), and nine (c) heated tubes.  
	$R_i = R/4$ for one heated tube, $R_i = R/8$ for four tubes and $R_i = R/12$ for nine tubes.
	Melting  front are localized with black lines.  $\Ray = 5 \cdot 10^4$, $\Pr =0.2$ and $\Ste = 0.02$.}  \label{fig-Luo-Field}
\end{figure}

\begin{figure} 
	\begin{center} 
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/Lf_Luo_2}
		\end{minipage}
	\end{center}
	\caption{Time evolution of the liquid fraction for one, four, and nine heated tubes. Comparison with numerical results of \cite{luo2015lattice}. $\Ray = 5 \cdot 10^4$, $\Pr =0.2$ and $\Ste = 0.02$.} \label{fig-Lf-Luo}
\end{figure}

\section{Solid crust formation in a highly distorted mesh} \label{sec-solid-crust}

\begin{figure} 
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/DOMAIN_Nourgaliev}
		\end{minipage}
	\end{center}
	\caption{Highly distorted computational domain for solid crust formation by \cite{nourgaliev2016fully}.}  \label{fig-Domain-Nourgaliev}
\end{figure}

The solid crust formation inside a highly distorted domain, simulated by \cite{nourgaliev2016fully} is of interest in this section.
Our emphasis here is placed on the ability of our method to tackle also solidification problem, especially in irregular domain.
For this purpose, we use the computational domain shown in Fig. (\ref{fig-Domain-Nourgaliev}) to simulate the solidification of liquid PCM at steady its steady state.
The six geometrical parameters, $X_0, X_1, Y_0, Y1, \alpha, \beta$ are set as follow:
\begin{eqnarray}
	X_0 &=& -1, \\
	X_1 &=& 1, \\
	Y_0 &=& -0.5, \\
	Y_1 &=& 0.5, \\
	\alpha &=& \beta = 20^o,
\end{eqnarray}
where $\alpha$ and $\beta$ define the level of stretching and distortion.

The fluid is initially motionless with an initial dimensionless temperature $\theta_i = 2$ well above the temperature of fusion.
The temperature of fusion is set to $\theta_f = 1.4$ according to \cite{nourgaliev2016fully} parameters.
It is worth noting that \cite{nourgaliev2016fully} have used $T_{ref} \ne T_f$ thus $\theta_f \ne 0$.
The left side is set at cold temperature $\theta_c = 1.39$ in the initial stage as the right wall was kept constant at a hot temperature $\theta_h = 2$, so that a steady-state natural circulation should be established. 
The cold temperature at the left wall is then dropped down to $\theta_c = 1$, below the temperature of solidification starting the formation of a solid crust layer. 
The top and the bottom walls are adiabatics.
The parameters of the simulation are: $\Ray = 1 \cdot 10^6$, $\Pr =0.1$ and $\Ste = 4.854$.
These investigated dimensionless parameters also allow to test the method's performance for low-Prandtl problem with high $\Ray$ and $\Ste$ numbers.
The scaling in eq. (\ref{eq-scaling-3}), which is also used by \cite{nourgaliev2016fully}, is used in the current simulation.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/Nourgaliev-Valid_2}
		\end{minipage}
	\end{center}
	\caption{Solid crust formation in a distorted mesh. Temperature field and streamlines of our simulation (a) and \cite{nourgaliev2016fully}  (b). } \label{fig-Nourgaliev}
\end{figure}

The dynamic of temperature field, the streamlines as well as the melting front position are reported in Fig. (\ref{fig-Nourgaliev}a) and compared with the numerical results of \cite{nourgaliev2016fully}.
\cite{nourgaliev2016fully} have used a second-order finite element with discontinuous Galerkin method and a $\mu$-based technique to bring the velocity to zero in the solid region.
We are qualitatively in a fairly good agreement with \cite{nourgaliev2016fully}.
As expected, the high $\Ray$ and $\Ste$ dimensionless numbers combined with the distorted domain generate a complex vortical flow pattern in the melted PCM.
\cite{nourgaliev2016fully} have investigated a mesh convergence analysis and have concluded that a $512 \times 256$ mesh resolution is needed to get a full resolution of the five vortical structures in Fig. (\ref{fig-Nourgaliev}b),
when only $11600$ triangles are performed in the present simulation.
This case illustrates again the power of our mesh adaptivity algorithm.

A last assessment of the performance of our sequential code is achieved in the next section by simulating the challenging case of water freezing.


\section{Water freezing} \label{sec-water-freeze}

We consider finally the difficult case of water freezing in a square cavity. 
After achieving the convection steady pattern in the cavity (see Figure \ref{fig-T1w-isoT}), freezing starts by dropping the temperature of the cold wall from $T_c=\celsm{0}$ to  $T_c=\celsm{-10}$. 
The new boundary condition on the right cold wall is imposed by setting a very thin layer of $\delta x=0.01$ with constant temperature $\theta=\theta_c$ and zero velocity.
The dimensionless parameter describing the problem are: $\Ray=2.518084\cdot 10^{6}$, $\Pr=6.99$ and $\Ste = 6.99$.

Besides the complex fluid flow and the non-linear time evolution of the solidi-liquid interface, the code have to handle the non-linear variation of the density presented in eq. \ref{eq-dens-nonlin}.
Moreover, one can note that in addition to the non-linear formulation of $f_B(\theta)$ in eq. (\ref{eq-fBnonlin}), the coefficient $\Ray \times 1/(\beta \delta T)$ is very large since the Boussinesq approximation imposes a value of $\beta \delta T \ll 0.01$.
Since the assumption of constant conductivity is not accurate in the frame of water phase-change, $K(\theta)$ is regularized following the smooth function:
\begin{equation}
K(T) =  1+ \frac{1}{2} \left( \frac{k_s}{k_l} - 1 \right)  \left\{
1 + \tanh \left( \frac{T_f-T}{R_{K}}\right)
\right\},
\label{eq-K-water}
\end{equation} 
with $k_s = 2.26$ and $k_l = 0.578$ the thermal conductivity of pure water in the solid and the liquid and $R_K = 0.0075$. 
The mushy-zone definition is also slightly modified compared to the melting case.
$\varepsilon_1 = \varepsilon_2 = 0.01$ was used in the simulation of PCM melting, $\varepsilon_1 = 0$ and $\varepsilon_2 = 0.0075$ is used for the solidification of water to ensure a very thin thickness of the mushy zone (see also \cite{dan-2014-JCP}).

Figure \ref{fig-T2w-manip} superimposes the experimental image from \cite{Kowalewski-1999} with our numerical results for the same physical time $t_{\varphi}=2340 [s]$. 
The flow pattern in the liquid phase also corresponds very well qualitatively to the experimental image. Since a good agreement with the experiment was sought,  the simulation was performed with very small time steps ($\delta t =10^{-4} \approx 0.15 [s]$), but still reasonable grids (less that 7000 nodes) due to the efficiency of the adaptivity algorithm.

The source term $S(\theta)$ is added to the metrics calculation presented in Sec. (\ref{sec: natconv-water}) to track the solidification front.
The mesh is thus refined along the line $\theta_m$ through the function $\Phi(\theta)$ defined in eq. (\ref{eq-Stm}), the solid-liquid interface defined by $\theta = 0$ and in the boundary layer regions.
We use also both $\Phi(\theta^n)$ and $\Phi(\theta^{n+1})$ and $S(\theta^n)$ and $S(\theta^{n+1})$ in the adaptivity procedure.
The final mesh is displayed in Figure \ref{fig-T2w-manipT}a, clearly showing that the mesh is refined along the line $\theta=\theta_m$ and the solid-liquid interface ($\theta=0$). This allows to accurately capture the structure and the extent of the two recirculating zones, features that are difficult to obtain with fixed meshes (see discrepancies described in \cite{Giangi-2000,Kowalewski-1999,Kowalewski-2003}).
As a consequence, the temperature level lines in Figure \ref{fig-T2w-manipT}b are smooth and clearly define the two interfaces in the system: the liquid-solid interface ($\theta=0$) and the density inversion interface ($\theta=0.4$) separating the two recirculating liquid regions.

\begin{figure}
	\begin{center}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/danaila_fig_10.jpg}
	\end{center}
	\caption{Freezing of pure water.  Configuration at (physical time) $t_{\varphi}=2340 [s]$: (a) experimental image from \cite{Kowalewski-1999}; the thick red line represents the solid-liquid interface computed with the present method (b) computed streamlines showing the two recirculating zones in the fluid phase.}
	\label{fig-T2w-manip}
\end{figure}
\begin{figure}
	\begin{center}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/danaila_fig_11.jpg}
	\end{center}
	\caption{Freezing of pure water.  Computed configuration at (physical time)  $t_{\varphi}=2340 [s]$: (a) finite-element mesh refined along the solid-liquid interface ($T=\celsm{0}$) and also along the line of maximum water density ($T=\celsm{4}$)  (b) temperature iso-lines.}
	\label{fig-T2w-manipT}
\end{figure}

\section{Concluding remarks}
In this chapter, we have demonstrated our numerical method's capability to produce highly accurate solutions of difficult multiphysics problems on several geometrical configuration.
The scope of complexity involve non-linear time evolution of the solid-liquid interface that could be highly deformed by the strong convection flow in the fluid phase.
Linear and non-linear expressions of the buoyancy force was investigated.

For the linear form of $f_B$, melting of paraffin (n-octadecane) and metal (gallium) have been simulated in rectangular cavity heated from the side.
The choice of these materials is motivated by their physical properties relatively equal in both solid and liquid phases and the existence of many numerical and experimental investigation in the literature.
Comparison with existing benchmarks have shown for each cases very good agreement.
The performance of the sequential code was also proven by simulating complex geometrical configuration.
The melting of cylindrical PCM including inner heated tubes and the solidification of liquid PCM inside irregular cavity have also shown good agreement with existing numerical data.

Non-linear expression of $f_B$ evolves in solidification of pure water. 
Besides the high $\Ray$ and $\Ste$ considered in our simulations, the efficiency of the mesh adaptivity was demonstrated by its capability to track simultaneously the interface $\theta = 0$ and the line $\theta = 0.4$ separating the two recirculating liquid regions.
Qualitative comparison with experimental image exhibits good agreement.
The vortical structures in the liquid water were accurately captured and the density inversion interface was precisely solved.

