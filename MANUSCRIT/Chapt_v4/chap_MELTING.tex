%%%%%%%%%%%%%%%%%%don't forget if needed %%%%%%%%%%%%%%%%%%%%%
%\section[toc version]{title version%
%              \sectionmark{head version}}
%\sectionmark{head version}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\def\titcourt{Numerical simulations of phase change material}
\def\titlong{Numerical simulation of phase change Materials in 2D configurations}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\chapter[\titlong]{\titlong%
              \chaptermark{\titcourt}}
\chaptermark{\titcourt}
\label{chap-MELTING}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%Having proven the accuracy and the efficiency of our numerical method by simulating the Navier-Stokes-Boussinesq equations, we now pay a closer attention to convective phase-change problems.
The purpose of this chapter is to validate our numerical method by simulating convective phase-change problems.
A discussion on numerical parameters is given first followed, by a sequence of validations computing different physical and geometrical configurations.

The Newton algorithm in Eq. \eqref{eq-newton-C1} is now solved throughout the whole domain containing liquid and solid phases.
When compared to the previous validation, two new non-linearities are now added: the Carman-Kozeny penalty term in the momentum equation and the enthalpy source term in the energy equation.
The Carman-Kozeny penalty term is used to ensure zero velocity in the solid region and 
the enthalpy non-linear source term is included to model the phase-change in the energy equation.
Following the same idea as in the natural convection validation cases in Chapter \ref{chap-NATCONV}, the non-linearity in the body force is gradually added.
We consider first the linear form of $f_B(\theta)$ by investigating the melting of various PCM within several shapes of the containers.
Then, the challenging case of water freezing, characterized by a non-linear variation of the density (see Eq. \eqref{eq-dens-nonlin} in Chapter \ref{chap-NATCONV}), is simulated.

Details about the parameter settings are first given in Sec. \ref{sec-param-set}:
the characteristics of the mushy-zone, the mesh adaptivity and the initial condition are discussed in details.
Second, the melting of n-octadecane and Gallium are presented in Secs. \ref{sec: melting-2D} and \ref{sec-melt-gallium}.
The physical properties of n-octadecane and Gallium used in our simulations are reported in Tab. \ref{tab-param-PCM}.
\begin{table}[!ht]
   \begin{center}
      \begin{tabular}{*{8}{cl}}
         
        &$\rho$ &$ \mu$ & $h_{SL}$ & $c_p $ & $k$ & $T_f$ & $\beta$ \\
        &kg/m$^3$ & kg/(m s) & kJ/kg & J/(kg K) & W/(m K) & K & 1/K \\
         \hline
        Octadecane & 774 & 3.9 $\cdot 10^{-3}$  & 244 & $2180$ & $0.152$ & $301$ & 8.5 $\cdot 10^{-4}$ \\
        Gallium & 6093 & 1.81 $\cdot 10^{-3}$  & 80.16 & $381.5$ & $32$ & $301$ & 1.2 $\cdot 10^{-4}$ \\
      \end{tabular}
   \end{center}
   \caption{Physical properties of n-octadecane and Gallium PCM.}
   \label{tab-param-PCM}
\end{table}



\noindent Then, in Secs. \ref{subsec-luo} and \ref{sec-solid-crust} we demonstrate the capability of our code to deal with different shape of the domain.
The melting of a cylindrical PCM with inner heated tubes is presented in Sec. \ref{subsec-luo} and the solid crust formation in a highly distorted mesh is carried out in Sec. \ref{sec-solid-crust}.
Finally, the water freezing case is performed in Sec. \ref{sec-water-freeze}.
Besides the non-linear definition of the body force, the striking feature of the water freezing simulation is the tracking of several interfaces, namely the solidification front and the anomalous thermal variation of density. 
Our result is qualitatively compared with the experimental results of \cite{Kowalewski-1999}.

%\newpage
\section{Parameter settings} \label{sec-param-set}
We present in this section the setting of the main numerical parameters. 
The influence of the penalty term $A(\theta)$ in the momentum equation is discussed first, namely the value of the Carman-Kozeny constant $\CKC$.
Second, details about the mesh adaptivity parameters are given.

\subsection{Carman-Kozeny constant}
The Carman-Kozeny penalty term is used to annihilate the velocity in the solid region when a single domain method is applied.
The Carman-Kozeny constant $\CKC$, appearing in Eq. \eqref{eq-CK} accounts for the mushy-region morphology.
The effect of this constant on the melting and the solidification processes have attracted some attention in the literature.
Even though it is generally assumed that a large value for $\CKC$ must be set, the exact value of this constant could influence the accuracy of the results. % \citep{kheirabadi2015effect, Kumar2017}. \\

\noindent The influence of $\CKC$ in the location of the solid-liquid front was investigated by \cite{kheirabadi2015effect}.
They have concluded that high $\CKC$ values induce a slower melting rates, and conversely small values result in unphysical predictions of the melting front development.
They also noticed that $\CKC$ and the melting temperature range $\Delta T_{\varepsilon} = T_{\varepsilon2}-T_{\varepsilon1}$ are dependent of one another: different values of $\Delta T_{\varepsilon}$ require different values of $\CKC$ to obtain the same melting front location.

\noindent \cite{Kumar2017} studied the effect of the mushy zone constant and its influence on the melt fraction, vortex strength and the amount of heat storage. They have shown that increasing $\CKC$ leads to a decrease of the convection strength and consequently to a decrease of the heat transfer rate. 
These studies show the necessity of choosing an appropriate value of this parameter. 
Because of the semi-solid state and porous nature of the mushy zone, the choice of the value of this constant is still an open problem.

To assess on the influence of the Carman-Kozeny constant, we simulate the melting of a n-octadecane PCM within rectangular enclosures with the following dimensionless parameters: $\Ray = 3.27 \cdot 10^5$, $\Prd = 56.2$ and $\Ste = 0.045$.
Different value of $\CKC$ are used ranging from $10^6$ to $10^{10}$. We compare the location of the melting front with the experimental data of \cite{Okada1984}.
Figure \ref{fig:pcm-CK} displays the location of the phase-change interface for three values of $\CKC$: $10^6$, $10^8$ and $10^{10}$.
Very good agreement with the experimental result of \cite{Okada1984} is obtained for $\CKC$ varying in the range $[10^6, 10^8]$. 
Imposing  a too large value, $\CKC=10^{10}$, results  in artificially slowing the propagation of the melting front. 

The local liquid fraction function $L_f(\theta)$ is regularized through the artificial mushy zone as following:
\begin{equation}
L_f(\theta) = 1 - \frac{1}{2}\left\{
1 + \tanh\left(\frac{\theta_{ck}-\theta}{R_{ck}}\right)
\right\}.
\label{eq-Lf-CK}
\end{equation}

\noindent The value of $\theta_{ck}$ is set in order to have the sharp variation of the derivative of d$L_f/$d$\theta$ near the new phase appearing in the system, i.e. liquid for melting ($\theta_{ck}=\varepsilon$), and solid  for freezing ($\theta_{ck}=\theta_f$) (see also \cite{dan-2014-JCP}).
This is to ensure that the velocity in the solid region is correctly set to $\vec u = 0$.
As far as $R_{ck}$ is concerned, several values ranging from $\varepsilon$ to $\varepsilon/4$ were tested and
we set for all subsequent simulations $\CKC= 10^6$ and $R_{ck} = \varepsilon$.

\begin{figure}
	\begin{center}
		\includegraphics[width=.5\textwidth]{\figpath/Fig_cap_melting/PCM_ck_compare}
	\end{center}
	\caption{Location of the interface during the melting of the PCM using different value of $\CKC$ ranging from $10^6$ to $10^{10}$. Comparison with experimental data of \cite{Okada1984}}
	\label{fig:pcm-CK}
\end{figure}

%\newpage
%\clearpage
\subsection{Mesh adaptativity}

The use of mesh adaptation proved mandatory in the present simulation of PCM melting to obtain accurate results within reasonable computational time.
For the melting case, we used five metrics intersection to adapt the mesh, based on $S^{n+1}, S^{n}, T^{n+1}, T^{n},$ and $\vec{u}^{n+1}$. To reduce the impact of the interpolation on the global accuracy for time-depending problems, we consider the metrics computed from actual (at $t_{n+1}$) and  previous (at $t_{n}$) values, for the same variable used for adaptivity (see also \cite{Belhamadia2004_S}).

\noindent The mesh adaptation strategy requires to set  the interpolation error level {\em errh}, the minimum and the maximum edge sizes {\em hmin} and {\em hmax}, and the {\em adaptratio} parameter, which defines the ratio for a prescribed smoothing of the metric.
The minimum size of triangles and the interpolation error level are set in order to capture the smaller length scale, mainly the boundary layer structures close to the wall, and to solve accurately the large gradient at the solid-liquid interfaces.
The error level is adapted for each variable on which the metric is computed.
A default value {\em errh = 0.02} is defined for $T$ and $\vec{u}$, and {\em errh = 0.2} for $S$.
%Furthermore, {\em hmin} should be set in order to capture the smaller length scale, mainly the boundary layer structures close to the wall, and to solve accurately the large gradient at the solid-liquid interfaces.
The scale for boundary layers in natural convection flow along a vertical wall is given by Eq. \eqref{eq-bnd-layer-T}. % and \ref{eq-corr-Low-Pr}.
For high-Prandtl simulations, the thickness of the thermal boundary layer is thinner than the viscous boundary layers, and conversely for low-Prandtl fluid the viscous boundary layer is thinner than the thermal one.
In our simulations, Rayleigh numbers in the range of $10^6$ to $10^8$ and Prandtl number of order of $50$, lead to a dimensionless thickness of the thermal boundary layer of order of $\delta_\theta \sim 10^{-3}$.
%Conversely, for low-Prandtl simulations the viscous boundary layer is thinner than the thermal boundary layer.
For the same range of Rayleigh numbers and Prandtl number of order of $0.1$, we have a dimensionless thickness of the viscous boundary layer of $\delta_\nu \sim 10^{-2}$. 
The minimum edge-length is therefore set to $hmin = 10^{-3}$.
Moreover, we fixe the maximum triangle size to avoid generating too large number of nodes. %, and we impose also the anisotropy of the mesh to have value close to $1$.
%The optimal parameters for the mesh adaptivity are given in Tab. \ref{tab-param-mesh}.
%\begin{table}
%   \begin{center}
%      \begin{tabular}{*{5}{cl}}
%               	hmin & hmax & adaptratio & errh & nbvx \\
%         	\hline
%         	$10^{-3}$ & $0.1$ & $1.5$ & $0.01$ & $50,000$ \\
%      \end{tabular}
%   \end{center}
%   \caption{Parameters for the mesh adaptivity.}
%   \label{tab-param-mesh}
%\end{table}
%Moreover, a minimum of 8 triangles should be included in the mushy zone to ensure an accurate location of the melting interface and a correct resolution of gradients.

%minimum edge-length is set to $h_{min} = 10^{-3}$ and the maximum edge-lenght to $h_{max} = 0.1$.
%Two values  \texttt{errh} $= 10^{-1}$ and \texttt{errh} $= 10^{-2}$, are computed and the corresponding meshes at $t=78.8$ are displayed in Fig. (FIG MAILLAGE).

\begin{figure}
	\begin{center}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/Mesh_MELT}
	\end{center}
	\caption{Adapted mesh during PCM melting. (a) $4,211$ triangles: mesh is refined around the melting front $\theta=0$ and in the fluid where velocity gradients exists. (b) zoom showing the decrease of the mesh size around the temperature isoline $\theta = 0$.}
	\label{fig:pcm-mesh}
\end{figure}

%\begin{figure}
%	\begin{center}
%		\includegraphics[width=.95\textwidth]{\figpath/Fig_cap_melting/MESH_analysis_PCM}
%		\includegraphics[width=.95\textwidth]{\figpath/Fig_cap_melting/NU-LF_MESH_analysis_PCM}
%	\end{center}
%	\caption{Adapted mesh during PCM melting. (a) $2,870$ triangles: mesh is refined around the melting front $\theta=0$ and in the fluid where velocity gradients exists. (b) zoom showing the decrease of the mesh size around the temperature isoline $\theta = 0$.}
%	\label{fig:pcm-mesh}
%\end{figure}

Mesh adaptivity is performed at each time step and offers a refined discretization of the regularization region where sharp gradients have to be accurately captured.  
%To ensure that we obtain a grid-converged solution, we perform different mesh resolutions  for the case presented in Fig. \ref{fig:pcm-CK} and test the influence of the number of triangles on the melting front, the Nusselt number, and the liquid fraction.
Fig. \ref{fig:pcm-mesh} shows the adapted mesh during the melting of Gallium PCM in a square cavity.
The mesh is remarkably refined around the melting front (Fig \ref{fig:pcm-mesh}b), localized by the temperature $\theta = 0$, and in the fluid region around the convection cells, while coarser mesh is applied in the solid.
The typical number of triangles of the generated adaptive mesh, during the simulation is $4,000$ triangles. 
Non-adapted grids offering the same spatial resolution everywhere inside the computational domain would have resulted in $N_t=9.94 \cdot 10^{10}$ triangles. 
Consequently, mesh adaptivity greatly helps in reducing the computational time. 
The mesh adaptivity capability to capture several interfaces is the striking feature of our method, mainly its capability to track efficiently two solidification fronts during PCM solidification or the density inversion interface during the water freezing will be discussed in Sec. \ref{sec-water-freeze}.

\subsection{Initialization}
For the melting process, the PCM is initially solid and the temperature is set to a cold temperature $\theta_c$ under the temperature of fusion $\theta_f$.
However, increasing abruptly the boundary temperature to a hot temperature $\theta_h$, over the temperature of fusion, in order to initiate the melting process is numerically complicate because of the strong temperature gradient between the wall and the PCM.
A first usual approach consists of setting a very thin fluid layer of thickness $\delta x \sim 0.01$ with isothermal temperature in the vicinity of the hot wall (see \cite{dan-2014-JCP,Belhamadia2004_S}.
A second approach, based on an establishment regime, will be applied in the current work.
The temperature at the hot wall and the Rayleigh number are increased smoothly over a small time steps up to reaching the correct value of $\theta_h$ and $\Ray$.
This approach has physical significance and is more robust when higher Rayleigh number simulations are performed.
Concerning the solidification stage, mainly the water freezing case, a 'hot' and a 'cold' restarts are carried out.
The first consists of establishing a steady state regime by solving first the steady Eq. \eqref{eq-weak-steady} and dropping then smoothly the temperature of the cold wall under the temperature of fusion.
The second sets directly $\theta_c$ under the temperature of fusion besides the motionless fluid, inducing thus huge gradients near the wall, requiring very small triangles therein.

\newpage

\section{Melting of n-octadecane PCM in a square cavity} \label{sec: melting-2D} %: Comparison with experimental data of \cite{Okada1984}  and \cite{gong2015numerical}, and numerical data of \cite{bertrand1999melting}.}
We start the validation of our algorithm for phase-change systems by simulating the melting of n-octadecane PCM within differentially heated rectangular cavity.
Three cases are investigated: \\
-- \underline{\textit{Benchmark $\#1$}}: Experimental investigation by \cite{Okada1984} of the melting of n-octadecane PCM. \\ % in enclosures of height $H=1.5$ cm. \\
%The non-dimensional parameters resulting from the physical properties of n-octadecane presented in Tab. (\ref{tab-param-PCM}) are: $\Ray = 3.27 \cdot 10^5$, $\Prd = 56.2$ and $\Ste = 0.045$ .\\
-- \underline{\textit{Benchmark $\#2$}}: Experimental and numerical investigations by \cite{gong2015numerical} of the melting of PCM inside a transparent building brick. \\ % of height $H = 15.2$ cm. \\
%The non-dimensional parameters corresponding to their experimental study are: $\Ray = 2.48 \cdot 10^8$, $\Prd = 50$ and $\Ste = 0.072$.\\
-- \underline{\textit{Benchmark $\#3$}}: Numerical comparison of various numerical methods, presented by \cite{bertrand1999melting}. \\ % considering high value of the Rayleigh number. \\
%The computed parameters are: $\Ray = 10^8$, $\Prd = 50$ and $\Ste = 0.1$.\\
%
\begin{table}[!ht]
   \begin{center}
	\begin{tabular}{*{7}{c}}
  	 	&  & $\Ray$ & $\Prd$ & $\Ste$ & $\delta t$ & $V_{ref}$ \\
   		\bottomrule
   		\multirow{3}{*}{n-octadecane} & Bench $\#1$ &   $3.27 \cdot 10^5$ &  $56.2$ & $0.045$ & $10^{-1}$ & \multirow{3}{*}{$\frac{\nu_l}{H}$} \\
    		& Bench $\#2$ & $2.48 \cdot 10^8$ & $50$  & $0.072$ & $10^{-3}$ &  \\
    		& Bench $\#3$ & $10^8$ & $50$  & $0.1$ & $10^{-5}$ &  \\
    		\hline
  		 \multicolumn{2}{c}{Gallium}  & $7 \cdot 10^5$ &$0.0216$  & $0.046$ & $10^{-3}$ & $\frac{\nu_l}{H}$ \\
		 \bottomrule
      \end{tabular}
   \end{center}
   \caption{Dimensionless parameters for melting of n-octadecane PCM.}
   \label{tab-param-pcm}
\end{table}

\begin{figure}
	\begin{center}
		\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/MESH_analysis_PCM}
		\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/NU-LF_MESH_analysis_PCM}
	\end{center}
	\caption{{Benchmark $\#1$}. Influence of the mesh resolution on the numerical solution at  dimensionless time $t=78.7$. Mesh is refined around the melting front $\theta=0$ and in the fluid where velocity gradients exists. Solid lines denote the solid-liquid interface. Number of triangles: (a) $48,247$, (b) $21,093$, (c) $2,870$, (d) $820$. The location of the interface (e) and the time evolution of the Nusselt number (f) are compared.}
	\label{fig:mesh-convergence-OKADA}
\end{figure}

The experimental investigation of \cite{Okada1984} in \textit{Benchmark $\#1$} consists of a differentially heated square cavity of dimensions $1.5$ cm $\times \, 1.5$ cm.
The left and the right walls are isothermal and the top and the bottom walls are adiabatic.
No-slip boundary conditions are prescribed on the velocity over the whole $\partial \Omega$.
The physical parameters used in our simulations are given in Tab. \ref{tab-param-pcm}.

To ensure that we obtain a grid-converged solution, we first perform different mesh resolutions for \textit{Benchmark $\#1$} by keeping the minimum edge length constant and increasing {\em hmax} from $10^{-2}$ to $10^{-1}$.
A snapshot of the adapted mesh at $t=78.7$ is reported in Fig. \ref{fig:mesh-convergence-OKADA}.

\noindent -- {\em Mesh} $\# 1$ (Panel a): $N_t = 48,247$ triangles and $314,203$ degree of freedom (d.o.f), \\
-- {\em Mesh} $\# 2$ (Panel b): $N_t = 21,093$ triangles and $143,202$ d.o.f, \\
-- {\em Mesh} $\# 3$ (Panel c): $N_t = 2,870$ triangles and $318,974$ d.o.f, \\
-- {\em Mesh} $\# 4$ (Panel d): $N_t = 820$ triangles and $5,544$ d.o.f.
%ranging from $N_t = 1,000$ triangles to $N_t = 50,000$ triangles, and test the influence of the number of triangles on the melting front and the Nusselt number  for \textit{Benchmark $\#1$} case.
%A snapshot of the mesh resolution at $t=78.7$ is depicted in Panels (a) to (d) of Fig. \ref{fig:mesh-convergence-OKADA}.

\noindent For all performed mesh, one can observe %refined meshes along the interface and the heated wall where high gradients could be localized.
finer mesh at the boundary layer region due to the high velocity gradients, mainly near the walls, and along the interface $\theta=0$, while coarser mesh is applied in the solid region.
We note however that a ratio of $10$ is set for {\em hmax} between {\em Mesh} $\# 1$ and {\em Mesh} $\# 4$, resulting to a ratio of $50$ on the number of d.o.f. using quadratic discretization of $T$.
Simulations are performed using $\delta t = 10^{-2}$ to ensure small time discretization errors.
%Differences of order of $54.7$ could be observed between {\em Mesh} $\# 1$ and .
The location of the solid-liquid interface and the time evolution of the Nusselt number related to each of the four adapted meshes are compared in Panels (e) and (f). 
The maximum discrepancies for the location of the melting front occur at the top of the cavity since the highest velocity is reached in this region because of the clockwise recirculation of the flow. 
We compare thus the position of the solid-liquid interface along  $x$-direction at $y=1$.
The coarser grid ({\em Mesh} $\# 4$) exhibits the highest gap with respect to the most refined  {\em Mesh} $\# 1$, with a relative error of $2.14 \%$ for the location of the melting front at the top of the cavity and by overestimating the heat transfer of an order of $3.83 \%$.
For {\em Mesh} $\# 3$, in which the mesh resolution is increased by a ratio of $3$ compared to the coarse mesh, reasonable differences of $0.042 \%$ and $0.039 \%$ are noticed for both $\mathcal{N}\!u$ and the interface.
Finally, from {\em Mesh} $\# 2$, variations lower than $0.01 \%$ are recovered.
However, since a balance between the accuracy and the computational time is sought, the subsequent simulation are performed using parameters of {\em Mesh} $\# 3$, summarized in Tab. \ref{tab-param-mesh}.
Solutions using {\em Mesh} $\# 3$ were actually performed with only $2876.39$ CPU seconds, while $12$ CPU hours were needed for {\em Mesh} $\# 1$.
\begin{table}
   \begin{center}
      \begin{tabular}{*{5}{cl}}
               	hmin & hmax & adaptratio & errh & nbvx \\
         	\hline
         	$10^{-3}$ & $0.1$ & $1.5$ & $0.01$ & $50,000$ \\
      \end{tabular}
   \end{center}
   \caption{Mesh adaptivity parameters used for {\em Mesh} $\# 3$.}
   \label{tab-param-mesh}
\end{table}

\begin{figure}
	\begin{center}
		\includegraphics[width=0.9\textwidth]{\figpath/Fig_cap_melting/MELT_Okada_valid_2}
	\end{center}
	\caption{\textit{Benchmark $\#1$}. 
	(a) Temperature isoline at $t=78.8$.
	(b) Location of the interface. Comparison with experimental data of \cite{Okada1984} and numerical solutions of \cite{dan-2014-JCP} and \cite{Wang2010} for two time instants ($t=39.9$ and $78.8$).
	(c) Vertical component of velocity field and location of the interface at $t=78.8$.
	(d) Adapted mesh with $2,900$ triangles at $t=78.8$. 
	% Benchmark 1: 
	%(b) Comparison with both experiment and simulation of \cite{gong2015numerical} for five time instants  ($\tau = 0.0002$, $0.00050$, $0.00067$, $0.00125$, $0.00252$). Benchmark 2: $\Ray = 2.48 \cdot 10^8$, $\Pr = 50$ and $\Ste = 0.072$.
	}
	\label{fig:pcm-valid}
\end{figure}

We present in Fig. \ref{fig:pcm-valid} the computed solution for \textit{Benchmark $\#1$} case using {\em Mesh} $\# 3$.
Panel (a) displays the temperature distribution of the PCM at dimensionless time $t=78.7$ in the unit square domain $\Omega = (0,1)^2$. 
The enclosure is heated from the left and the melting PCM expands from the left to the right (the blue color denotes the solid region).
A non-planar shape of the phase-change interface could be observed due to effect of the natural convection in the liquid phase.
Further comprehensive descriptions of the influence of the liquid flow on the interface will be discussed in Chapter \ref{chap-MELTING-ANALYSIS}.
Panel (b) compares the location of the solid-liquid interface with experimental investigation of  \cite{Okada1984}.
For two particular time instants, $t=39.9$ and $t=78.7$, we could compare our results to available experimental \citep{Okada1984} and numerical \citep{Okada1984,Wang2010,dan-2014-JCP} data. 
In the experimental set up, the author has reported that the top of the PCM was not perfectly insulated and consequently the growth of the experimental upper melting front was delayed.
The current work agrees well with the experimental results of \cite{Okada1984} at the bottom part of the melting front.
However, our results overestimate the location of the front in the top part of the cavity, which could be related to the experimental heat loss mentioned by the author. 
Moreover, our results are qualitatively in a better agreement with experimental data than previously published numerical results. 
This is a direct consequence of the precise tracking of the melting front achieved by the mesh adaptivity performed at each time step.
\cite{Wang2010} have used a FV code with a fixed mesh of resolution $[60 \times 60]$, and \cite{dan-2014-JCP} have used a first order FE method with adaptive grid. 

%\noindent The vertical component of the velocity field and the resulted adapted mesh at $t=78.7$ are given in panels (c) and (d).
%Thinner mesh could be observed in the boundary layer region due to the high velocity gradients, mainly near the walls, and along the interface $\theta=0$, while coarser mesh is applied in the solid region.
%Panel (c) corresponds to adapted mesh with $2,900$ triangles. 
%The numerical solution presented in Fig. \ref{fig:pcm-valid} were obtained with only $2876.39$ CPU seconds.

Numerical results for \textit{Benchmark $\#2$} are depicted in Fig. \ref{fig:pcm-Gong}.
The numerical simulation is performed using $\delta t = 10^{-3}$ and a total runtime of $19,231$ CPU seconds using $4,198$ triangles.
\cite{gong2015numerical} have investigated the melting of octadecane PCM inside a transparent building brick of dimensions $15.2$ cm $\times$ $3$ cm.
Panel (a) illustrates the temperature distribution in the melting PCM, the streamlines, and the phase-change interface obtained by the present finite element simulation.
Panel (b) compares the location of the melting front for five particular time instants: $t=0.153$, $0.347$, $0.465$, $0.869$, and $1.759$, with numerical and experimental data by \cite{gong2015numerical}.
Their numerical simulations were based on the thermal lattice Boltzmann method (TLBM), in which the natural convection got solved by LBM and the temperature equation was solved by finite difference scheme using enthalpy method. 
The difficulty here compared to the first validation case is the presence of a stronger natural convection flow in the fluid due to the higher value of the Rayleigh number.
%The location of the melting front is compared for five particular time instants: $\tau = 0.0002$, $0.00050$, $0.00067$, $0.00125$ and $0.00252$.
%Their numerical simulation has been performed using a hybrid thermal Lattice Boltzmann method combined with an enthalpy method. 
%The location of the interface is compared for five particular time instants: $\tau = 0.0002$, $0.00050$, $0.00067$, $0.00125$ and $0.00252$.
We notice a very good agreement with respect to both numerical and experimental data of \cite{gong2015numerical}.

\begin{figure}
	\begin{center}
		\includegraphics[width=0.95\textwidth]{\figpath/Fig_cap_melting/MELT_Gong_valid}
	\end{center}
	\caption{\textit{Benchmark $\#2$}. 
	(a) Temperature distribution, streamlines, and solid-liquid interface at dimensionless time $t=1.759$.
	(b) Comparison of the location of the solid-liquid interfaces, with both experiment and simulation of \cite{gong2015numerical}, for five time instants  ($t=0.153$, $0.347$, $0.465$, $0.869$, and $1.759$).}
	\label{fig:pcm-Gong}
\end{figure}

A last validation case, for the n-octadecane PCM, is also investigated to test the robustness of the method.
\cite{bertrand1999melting} compiled results provided by five different authors (Lacroix, Le Qu{\'e}r{\'e}, Gobin-Vieira, Delannoy and Binnet-Lacroix). Results provided by these authors will be hereafter referred to as (say) 'Lacroix, from \cite{bertrand1999melting}'.
They have attempted a first comparison by taking several numerical methods to compute the basic configuration presented in this section. 
Two investigators among the five failed to predict the process and showed unrealistic behaviors (see Figs. \ref{fig Bertran} and \ref{fig-Nu-Lf-Bertran}):
Lacroix and Delannoy seem to be insufficiently converged (Fig. \ref{fig Bertran}), and Binet-Lacroix overestimates the average Nusselt number by more than $30 \%$ (Fig. \ref{fig-Nu-Lf-Bertran}).
Hence, this collection of results allows us to compare our numerical method and check whether or not realistic results are obtained for complex physical configurations.

\noindent We further inspect the melting front, the temporal evolution of the liquid fraction $L_f$ and the Nusselt number $\mathcal{N}\!u$ at the left wall ($x=0$), for each of the five methods presented by \cite{bertrand1999melting}.
For the liquid fraction, the initial solid state corresponds to $L_f = 0$, while  $L_f = 1$ indicates the  complete melting of the PCM. 
%The average Nusselt number $N\!u$ at $x=0$ left boundary is defined as follows:
%\begin{equation}\label{eq-Nu}
%N\!u = \int_{0}^1 \left(\frac{\partial \theta}{\partial x}\right)_{x=0}\, dy.
%\end{equation}
%\\
\begin{figure}
	\begin{center}
		\begin{minipage}[t]{0.8\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/fig03}
		\end{minipage}
	\end{center}
	\caption{\textit{Benchmark $\#3$}. Location of the solid-liquid interface at dimensionless time (panels a to d) $t=0.25$,  $t=1$, $t=3$, and $t=5$, compared with five simulations presented by \cite{bertrand1999melting}. 
	} \label{fig Bertran}
\end{figure}
\begin{figure}
	\begin{center}
		\begin{minipage}[t]{0.8\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/Lf-Nu_Bertrand}
		\end{minipage}
	\end{center}
	\caption{\textit{Benchmark $\#3$}: $\Ray = 2 \cdot 10^8$, $\Prd = 50$ and $\Ste = 0.1$. Time evolution of the liquid fraction (a) and  the  Nusselt number (b) compared with five simulations presented by \cite{bertrand1999melting}.
	} \label{fig-Nu-Lf-Bertran}
\end{figure}
The phase-change interface for four time steps, $t=0.25$,  $t=1$, $t=3$ and $t=5$ is represented in Fig. \ref{fig Bertran}.
Our results are for each case in fairly good agreement with those of Gobin and those of  Le Qu{\'e}r{\'e}.
Gobin uses a front-tracking method using a coordinate transformation with a finite volume method with a $62 \times 42$ grids.
Le Quéré solves a single domain model using a second order scheme with a finite volume method with a $192 \times 192$ grids  (\cite{gobin2000melting}).
The time evolution of the liquid fraction and the  Nusselt number are moreover plotted in Fig. \ref{fig-Nu-Lf-Bertran}.
A very good agreement is obtained with Gobin and Le Qu{\'e}r{\'e}.
A relative difference, less than $2\%$ is noticed for the Nusselt number, and a dispersion, smaller than $4 \%$, for the melted fraction.
The high value of the Rayleigh number, $\Ray = 10^8$, results in a very demanding numerical test.
The high velocity, inducing a very narrow thermal boundary layer can lead to unrealistic results and some numerical methods have failed.
The interest of the mesh adaptation is clearly evidenced since a typical number of triangles of $N_t = 7,000$ were used during the simulation, which have necessitated $40,522$ CPU seconds of run.


\section{Melting of Gallium in a rectangular cavity} \label{sec-melt-gallium}

%The observation on the melting of the gallium in a rectangular cavity was a controversy since the question if  the flow in the fluid is monocellular of multicellular was raised by \cite{dantzig1989modelling}.
The melting of tin or Gallium in a rectangular cavity, which corresponds to low-Prandtl fluids, was a controversial case since  \cite{dantzig1989modelling} raised the question 
whether  the convection in the fluid is mono-cellular or multi-cellular.
The experimental result exhibits indeed a mono-cellular structure, while many researchers claim this observation to be incorrect.
Prior to \cite{dantzig1989modelling} note, both experimental and numerical results support a single cell solution in the fluid phase.
Later, simulations provide solutions with multicellular flow. 
During the comparison exercise investigated by \cite{bertrand1999melting}, Le Quéré and Couturier-Sadat have predicted a different shape of the front corresponding the low-Prandtl simulation, induced by the multi-cellular structures of the flow in the melted PCM.
\cite{le1999note} have shown that the multi-cellular structures result from thy hydrodynamic instabilities during the conduction regime before the onset of convection.
Moreover, numerical investigation of \cite{hannoun2003resolving}, testing the influence of the mesh resolution and the numerical method's order, indicates clearly that mono-cellular observation is caused by a problem of convergence of the numerical solution. It can be due to the grid size or inconsistencies in the mathematical model.

\noindent Therefore, this test case simulating the melting of Gallium is a relevant exercice to test the consistency of our method.
To capture the very small cell during the first step of the melting, \cite{hannoun2003resolving} uses a $800 \times 1,120$ fixed grids in a rectangular domain of dimensions $6.35$ cm $\times \, 8.89$ cm. 
The authors have reported that the melting solution up to 32 s have required about $980$ CPU hours on a Compaq Alpha ($667$ MHz, ev$67$) processor.
However, a maximum of $4, 820$ triangles are necessary with our adaptive method, and only $4$ CPU hours are spent to reproduce the numerical result of \cite{hannoun2003resolving} up to the final time 280s, on an Intel ($2,8$ GHz, Core i$7$) processor.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/figsCPC_11}
			\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/HANNOUN_mesh_Nu}
		\end{minipage}
	\end{center}
	\caption{Melting of Gallium: temperature field, streamlines, and melting front for dimensionless time instants (panels a to d): 
	$t = 0.0015$, $0.006$, $0.01$, and $0.019$. Adapted mesh corresponding to $t = 0.019$ (e). Time evolution of the Nusselt number (f). For a better view of the convection cells, a ratio $2:1$ was used for the axis dimensions.} \label{fig-Gallium}
\end{figure}

The time evolution of the flow  is presented in the Fig. \ref{fig-Gallium}. 
The enclosure is heated from the left (vertical) wall and the horizontal walls are adiabatic and no-slip.
The physical properties of the Gallium and the dimensionless parameters of the run are given in Tabs. \ref{tab-param-PCM} and \ref{tab-param-pcm}.
Temperature field, streamlines and position of the melting front are displayed for several time instants: $t= 0.0015$, $0.006$, $0.01$, and $0.019$.
These values were chosen to visualize the merging of convection cells in the fluid flow and correspond to physical times $20s, 85s, 155s, 280s$ in \cite{hannoun2003resolving}.
The number of rolls was considered as a validation criterion by several authors 
\citep{hannoun2003resolving,cerimele2002numerical,giangi2000melting}.
Three cells are observed  at $t=0.006$ (Fig. \ref{fig-Gallium}). The number of cells decreases later through a process of roll merging, as it was also reported  by \cite{le1999note} and \cite{hannoun2003resolving}. Our numerical results are in good agreement with the observations of \cite{hannoun2003resolving}, \cite{cerimele2002numerical} and \cite{giangi2000melting}.
The adapted mesh corresponding to $t = 0.019$ is illustrated in Panel (e).
The mesh is well refined along the isoline $\theta = 0$ denoting the interface, and around the convective cells.

The time evolution of the Nusselt number at the heated vertical wall is plotted in Fig. \ref{fig-Gallium}f.
One can note that the quasi-steady evolution of $\mathcal{N}\!u$ in Fig. \ref{fig-Nu-Lf-Bertran}, for high-Prandtl fluid simulations, is not recovered. 
This is in total accordance with the instability analysis of \cite{le1999note} showing that the Nusselt number becomes unsteady starting from a critical time, for Rayleigh numbers greater than $10^5$ for low-Prandtl simulation, 
while no instability could be found whatever the value of $\Ray$ for high-$\Prd$ cases.
The first slight oscillation at the very earlier time steps corresponds to the onset of the convective flow induced by the first instability of the conductive regime,
which is followed by a nearly constant evolution of $\mathcal{N}\!u$ from $t = 0.01$ to $t = 0.02$ during the cell-merging processes.
High oscillations of the heat transfer are then observed, which is feature of the onset of the second oscillatory instability.
A zoom of the periodic evolution of the Nusselt number is displayed in Panel (f).
Finally, the amount of heat transfer decreases from $t=0.13$ when the front reaches the cold (right) vertical wall.

\section{Melting of cylindrical PCM with inner heated tubes} \label{subsec-luo}
Cases presented in Secs. \ref{sec-melt-gallium} and \ref{sec: melting-2D} considered phase change problems evolving in a simple geometry, a rectangular box.
%We have simulated previously phase-change problems within rectangular cavities.
%A more complex system is studied in this section, by simulating the melting of pure PCM on multitube thermal energy storage systems.
A more complex geometry, suggested by \cite{luo2015lattice}, is simulated in this section. It consists of a cylindrical PCM of  radius $R=1$ with tube inclusions of different arrangements.
%Similar configurations were studied by \cite{luo2015lattice}. Hence we could compare our numerical results to those of \cite{luo2015lattice}.
%The interest is twofold: the geometry is challenging since is it complex and \cite{luo2015lattice} uses Lattice Boltzmann method, a microscopic model, which is different from previous validation cases.
The interest in studying this case is not solely the challenge of the complex configuration, but also the possibility to compare our results with those of \cite{luo2015lattice}, obtained using a completely different model based on the Lattice Boltzmann Method. This configuration is also interesting from a practical point of view.
\cite{agyenim2010review} pointed out that more than $70\%$ of the PCM containers used for heat storage  are using shell-tube systems.

%Cylindrical PCM of dimensionless radius $R=1$ with tube inclusions are studied.
%Shell and tube PCM are indeed most intensely used in latent heat energy storage systems.
%\cite{agyenim2010review} pointed out, in a critical review of materials used for heat storage, that more than $70\%$ of the PCM container are using the shell and the tube system.

We simulate three cases taking into account one heated tube, four heated tubes, and nine heated tubes with the same contact area.
For the one heated tube case, the radius $R_i$ of the inner tube is one-quarter of the outer tube ($R_i = R/4$), for four heated tubes $R_i = R/8$ and for nine heated tubes $R_i = R/12$.
A Dirichlet boundary condition is applied to inner tubes $\theta = \theta_h$,
and a Neumann boundary condition $\frac{\partial \theta}{\partial n} = 0 $ is used at the outers.
Homogenous Dirichlet boundary conditions ($\vec u = 0$) are prescribed on the velocity throughout on $\partial \Omega$.
The physical parameters of the simulation are:  $\Ray = 5 \cdot 10^4$, $\Prd =0.2$ and $\Ste = 0.02$.
It is worth noting that only the half of the domain is simulated since the problem is axisymmetric for the investigated $\Ray$ number.
At $t=0$, the PCM is completely solid with isothermal temperature $\theta_0$ lower than the temperature of fusion.
Immediately after the pipe placed on the center of the enclosure is heated, the melt layer expands in the radial direction.
The mesh is refined initially around inner tubes, and is dynamically adapted at each time step around the melting front and the thermal boundary layer area.

Fig. \ref{fig-Luo-Field} shows  the temperature field and the position of the solid-liquid interface (black line) related to the three configurations for time instants corresponding to the same liquid fraction $L_f=80\%$. 
The distribution of  the inner tubes in the liquid phase influences directly the fluid motion and the shape of melting front.
The more the number of inner tubes, the stronger the natural convection is  in the melted PCM. 
The shape of the solid-liquid interface displays complex patterns, depending on the space arrangement of the inner tubes. 
This is linked to the effect of the fluid motion in the presence of obstacles as it was also noticed in Sec. \ref{sec: natconv-water}.
The mesh is nicely adapted following the evolution of the melting interface, even after its separation in several distinct fronts touching the outer boundary (see Figs. \ref{fig-Luo-Field}b, c). 

To estimate the efficiency of each configuration, we plot in Fig. \ref{fig-Lf-Luo} the time evolution of the liquid fraction $L_f$. 
By including more heated tubes the heat transfer is enhanced, inducing a faster melting time.  
The nine-tube configurations melts $5$ times faster than the reference configuration with one tube.
A reasonably close match with numerical results of \cite{luo2015lattice} is confirmed by looking at Fig. \ref{fig-Lf-Luo}a.
We also assess the effect of tubes arrangements with fixe obstacle number. 
Three arrangements are simulated with $9$ obstacles and reported in Fig. \ref{fig-Lf-Luo}b: centrosymmetric, inline, and staggered arrangements.
Centrosymmetric arrangement appears to provide a better heat transfer compared to the others.
The inline and the staggered arrangements exhibit similar trends, with a slightly faster melting rate within the inline arrangement.
The difference is explained by \cite{luo2015lattice} by the contribution of conductive heat transfer induced by the arrangements.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/figsCPC_09}
		\end{minipage}
	\end{center}
	\caption{Temperature fields for the melting of a cylindrical PCM with inner heated tubes. 
	Time instants corresponding to the same liquid fraction $L_f=80\%$. 
	Configurations with  (a) one tube ($t=2.5$), (b) four tunes ($t=0.99$) and (c) nine tubes ($t=0.4$).
	Melting  front are localized with black lines (only half of the domain is simulated).  
	}  \label{fig-Luo-Field}
\end{figure}

\begin{figure} 
	\begin{center} 
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=.9\textwidth]{\figpath/Fig_cap_melting/Lf_Luo_3}
		\end{minipage}
	\end{center}
	\caption{Time evolution of the liquid fraction for one, four, and nine heated tubes. (a) Comparison with numerical results of \cite{luo2015lattice} (b) comparison of centrosymmetric, inline, and staggered arrangements.} \label{fig-Lf-Luo}
\end{figure}

\newpage
\section{Solid crust formation in a highly distorted mesh} \label{sec-solid-crust}
%
%\begin{figure} 
%	\begin{center}
%		\begin{minipage}[t]{\textwidth}
%			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/DOMAIN_Nourgaliev}
%		\end{minipage}
%	\end{center}
%	\caption{Highly distorted computational domain for solid crust formation by \cite{nourgaliev2016fully}.}  \label{fig-Domain-Nourgaliev}
%\end{figure}

The solid crust formation inside a highly distorted domain, simulated by \cite{nourgaliev2016fully} is of interest in this section.
Our emphasis here is placed on the ability of our method to tackle also solidification problem, especially in irregular domain (see Fig. \ref{fig-Nourgaliev}).
%For this purpose, we use the computational domain shown in Fig. (\ref{fig-Domain-Nourgaliev}) to simulate the solidification of liquid PCM at steady its steady state.
%The six geometrical parameters, $X_0, X_1, Y_0, Y1, \alpha, \beta$ are set as follow:
%\begin{eqnarray}
%	X_0 &=& -1, \\
%	X_1 &=& 1, \\
%	Y_0 &=& -0.5, \\
%	Y_1 &=& 0.5, \\
%	\alpha &=& \beta = 20^o,
%\end{eqnarray}
%where $\alpha$ and $\beta$ define the level of stretching and distortion.

The fluid is initially motionless with an initial dimensionless temperature $\theta_0 = 2$ well above the temperature of fusion.
The temperature of fusion is set to $\theta_f = 1.4$ according to \cite{nourgaliev2016fully} parameters.
It is worth noting that \cite{nourgaliev2016fully} have used $T_{ref} \ne T_f$ thus $\theta_f \ne 0$.
The left side is set at cold temperature $\theta_c = 1.39$ in the initial stage as the right wall was kept constant at a hot temperature $\theta_h = 2$, so that a steady-state natural circulation should be established. 
The cold temperature at the left wall is then dropped smoothly down to $\theta_c = 1$, below the temperature of solidification, starting the formation of a solid crust layer. 
The top and the bottom walls are adiabatics.

The dimensionless parameters of the simulation are: $\Ray = 1 \cdot 10^6$, $\Prd =0.1$ and $\Ste = 4.854$.
%These investigated dimensionless parameters also allow to test the method's performance for low-Prandtl problem with high $\Ray$ and $\Ste$ numbers.
The scaling in Eq. \eqref{eq-scaling-3}, which is also used by \cite{nourgaliev2016fully}, is used in the current simulation.

\begin{figure}
	\begin{center}
		\begin{minipage}[t]{\textwidth}
			\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/figsCPC_12}
		\end{minipage}
	\end{center}
	\caption{Solid crust formation in a distorted mesh. Temperature field and streamlines of our simulation (a) and \cite{nourgaliev2016fully}  (b). } \label{fig-Nourgaliev}
\end{figure}

The temperature distribution, the streamlines as well as the melting front position are reported in Fig. \ref{fig-Nourgaliev}a and compared with the numerical results of \cite{nourgaliev2016fully},
who have used a second-order discontinuous Galerkin finite element method and a $\mu$-based technique to bring the velocity to zero in the solid region.
We are qualitatively in a fairly good agreement with \cite{nourgaliev2016fully}.
As expected, the high $\Ray$ and $\Ste$ dimensionless numbers combined with the distorted domain generate a complex vortical flow pattern in the melted PCM.
\cite{nourgaliev2016fully} have investigated a mesh convergence analysis and have concluded that a $512 \times 256$ mesh resolution is needed to get a full resolution of the five vortical structures in Fig. \ref{fig-Nourgaliev}b,
while only $2,769$ triangles are performed in the present simulation.
This case illustrates again the power of our mesh adaptivity algorithm.

%A last assessment of the performance of our sequential code is achieved in the next section by simulating the challenging case of water freezing.


\section{Water freezing} \label{sec-water-freeze}

We consider finally the difficult case of water freezing in a square cavity. 
After achieving the convection steady pattern in the cavity (see Fig. \ref{fig-T1w-isoT}), freezing starts by dropping progressively the temperature of the cold (right) wall from $T_c=\celsm{0}$ to  $T_c=\celsm{-10}$. 
%The new boundary condition on the right cold wall is imposed by setting a very thin layer of $\delta x=0.01$ with constant temperature $\theta=\theta_c$ and zero velocity.
The dimensionless parameters describing the problem are: $\Ray=2.518084 \cdot 10^{6}$, $\Prd=6.99$ and $\Ste = 0.125$.

Besides the complex fluid flow and the non-linear time evolution of the solid-liquid interface, the code have to handle the non-linear variation of the density presented in Eq. \eqref{eq-dens-nonlin}.
Moreover, one can note that in addition to the non-linear formulation of $f_B(\theta)$ in Eq. \eqref{eq-fBnonlin}, the coefficient $\Ray \times 1/(\beta \delta T)$ is very large since the Boussinesq approximation imposes a value of $\beta \delta T \ll 1$.
Since the assumption of constant conductivity is not accurate in the frame of water phase-change, $K(\theta)$ is regularized following the smooth function
\begin{equation}
K(T) =  1+ \frac{1}{2} \left( \frac{k_s}{k_l} - 1 \right)  \left\{
1 + \tanh \left( \frac{T_f-T}{R_{k}}\right)
\right\},
\label{eq-K-water}
\end{equation} 

\noindent with $k_s = 2.26$ and $k_l = 0.578$ the thermal conductivity of pure water in the solid and the liquid and $R_k = 0.0075$. 
%The mushy-zone definition is also slightly modified compared to the melting case.
We also define $\varepsilon_1 = 0$ and $\varepsilon_2 = 0.0075$, to ensure a very thin thickness of the mushy zone (see also \cite{dan-2014-JCP}).

Fig. \ref{fig-T2w-manip}a superimposes the experimental image from \cite{Kowalewski-1999} with our numerical results for the same physical time $t_{\varphi}=2340 [s]$. 
The flow pattern in the liquid phase also corresponds very well qualitatively to the experimental image. 
Since a good agreement with the experiment was sought,  the simulation was performed with very small time steps ($\delta t =10^{-5} \approx 0.014 [s]$), but still reasonable grids ($2,500$ triangles) due to the efficiency of the adaptivity algorithm.
The discrepancy between the experimental interface and the current simulation comes principally from the model, mainly the three-dimensional effects, the supercooling of water and realistic boundary conditions (see \cite{Giangi-2000,Kowalewski-1999,Kowalewski-2003}) that are not taken into account by the present numerical method.

The source term $S(\theta)$ is added to the metrics calculation presented in Sec. \ref{sec: natconv-water} to track the solidification front.
The mesh is thus refined along the line $\theta_m$ through the function $\Phi(\theta)$ defined in Eq. \eqref{eq-Stm}, the solid-liquid interface defined by $\theta = 0$ and in the boundary layer regions.
We use also both $\Phi(\theta^n)$ and $\Phi(\theta^{n+1})$ and $S(\theta^n)$ and $S(\theta^{n+1})$ in the adaptivity procedure.
The final mesh is displayed in Fig. \ref{fig-T2w-manip}c, clearly showing that the mesh is refined along the line $\theta=\theta_m$ and the solid-liquid interface ($\theta=0$). This allows to accurately capture the structure and the extent of the two recirculating zones, features that are difficult to obtain with fixed meshes (see discrepancies described in \cite{Giangi-2000,Kowalewski-1999,Kowalewski-2003}).
%As a consequence, the temperature level lines in Fig. \ref{fig-T2w-manip}d are smooth and clearly define the two interfaces in the system: the liquid-solid interface ($\theta=0$) and the density inversion interface ($\theta=0.4$) separating the two recirculating liquid regions.

The time evolution of the solid-liquid interface is depicted in Fig. \ref{fig-T2w-manip}d for several time instants from $t=0.05$ ($t_{\varphi}=70 [s]$) to final time $t=1.61$ ($2340 [s]$).
We observe first a straight shape of the front from $t = 0$ to $t = 0.05$.
Then, the top and the bottom of the freezing front move at different rates from $t = 0.3$ due to the competing effects of positive and negative buoyancy force in the unsolidified water.
The upper clockwise circulation has indeed the task to transport the hot liquid to the top wall and back along the extremum of the density variation (localized at the temperature isoline $\theta = \theta_m$), and slow consequently the growth of the solid layer.
However, the abnormal recirculation traps the cold liquid water at the bottom part of the cavity, enhancing thus the solidification rate at this region as one can note in Fig. \ref{fig-T2w-manip}d.

\begin{figure}
	\begin{center}
		%\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/figsCPC_15}
		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/WFREEZ_thesis}
	\end{center}
	\caption{Freezing of pure water.  Configuration at (physical time) $t_{\varphi}=2340 [s]$ (t = 1.61): (a) experimental image from \cite{Kowalewski-1999}; the thick red line represents the solid-liquid interface computed with the present method (b) computed streamlines showing the two recirculating zones in the fluid phase.
	(c) finite-element mesh refined along the solid-liquid interface ($T = 0^oC$) and also along the line of maximum water density ($T = 4^oC$) (d) location of the solidification front for several time instants: from $t=0.05$ (corresponding to physical time $t_{\varphi}=70 [s]$) to $t=1.61$ ($2340 [s]$)}
	\label{fig-T2w-manip}
\end{figure}
%\begin{figure}
%	\begin{center}
%		\includegraphics[width=\textwidth]{\figpath/Fig_cap_melting/danaila_fig_11.jpg}
%	\end{center}
%	\caption{Freezing of pure water.  Computed configuration at (physical time)  $t_{\varphi}=2340 [s]$: (a) finite-element mesh refined along the solid-liquid interface ($T=\celsm{0}$) and also along the line of maximum water density ($T=\celsm{4}$)  (b) temperature iso-lines.}
%	\label{fig-T2w-manipT}
%\end{figure}

%\newpage
%\clearpage
\section{Concluding remarks}
In this chapter, we have demonstrated our numerical method's capability to produce highly accurate solutions of difficult multiphysics problems on several geometrical configuration.
The scope of complexity involve non-linear time evolution of the solid-liquid interface that could be highly deformed by the strong convection flow in the fluid phase.
Linear and non-linear expressions of the buoyancy force were investigated.

\noindent For the linear form of $f_B$, melting of pure paraffin (n-octadecane) and metal (Gallium) have been simulated in rectangular cavity heated from the side.
The choice of these materials is motivated by their physical properties relatively equal in both solid and liquid phases, the existence of many numerical and experimental investigations in the literature, and also the differences between the time evolution of the heat transfer for high and low $\Prd$ simulations.
Comparison with existing benchmarks have shown for each cases very good agreement.
The unsteadiness of the flow for the Gallium was observed in our simulations by the multi-cellular structure of the liquid flow and the high oscillating value of the Nusselt number.
The performance of the sequential code was also proven by simulating complex geometrical configuration.
The melting of cylindrical PCM including inner heated pipes and the solidification of liquid PCM inside irregular cavity have shown good agreement with existing numerical data.

\begin{table}
\centering
\begin{tabular}{*{4}{c}}
   \multicolumn{2}{c}{Case}  & {\small CPU time (s)} & {\small Number of triangles}  \\
  \toprule 
  \multirow{3}{*}{N-octadecane} & Bench $\#1$ & $2876.39$ & $2,900$ \\
  %\cline{2-4}
   & Bench $\#2$  & $19231$ & $4,198$ \\
   & Bench $\#3$  & $40522.7$ & $7,000$ \\
   \hline
   \multicolumn{2}{c}{Gallium} & $14621.2$ & $4,820$ \\
   \hline
  %\multicolumn{2}{c}{Cylindrical PCM} & $14621.2$ & $4,820$ \\
  \multicolumn{2}{c}{Cylindrical PCM} & $2060.42$ & $3,076$ \\
  \hline
  \multicolumn{2}{c}{Highly distorted PCM} & $6657.58$ & $2,769$ \\
%  {\small CPU time} & $2876.39$ & $40522.7$ & $2060.42$ & $14621.2$ & $6657.58$\\
%  {\small Number of triangles} & $2,900$ & $7,000$ & $3,076$ & $4,820$ & $2,769$ \\
\bottomrule
 \end{tabular}
\caption{Summary of melting simulations: number of triangles and CPU times.}
\label{tab-melt-cases}
\end{table}

\noindent The total CPU time and the typical number of triangles corresponding to each PCM cases are summarized in Tab. \ref{tab-melt-cases}.
Noticeable is the fact that, less than $2$ CPU hours are necessary for most of the simulations, even a sequential algorithm is used. 
The interest and the power of mesh adaptivity was highlighted by the simulation of the melting of the Gallium, since only $4$ CPU hours are necessary to perform this case, while $980$ CPU hours were needed by \cite{hannoun2003resolving} using fixed-grid algorithm.

\noindent Non-linear expression of $f_B$ was considered for the solidification of pure water case. 
Besides the high $\Ray$ and $\Ste$ considered in our simulations, the efficiency of the mesh adaptivity was demonstrated by its capability to track simultaneously the interface $\theta = \theta_f$ and the line $\theta = \theta_m$ separating the two recirculating liquid regions.
Qualitative comparison with experimental image exhibits good agreement.
The vortical structures in the liquid water were accurately captured and the density inversion interface was precisely solved.

\noindent More comprehensive description of the melting process will be presented in the next chapter.
Numerical and analytical tools will be performed to analyse and compare the melting of PCM heated either from the side or from below.
